 <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pets of the NBA – Gallery (Debug)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    *,
    *::before,
    *::after { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0f172a;
      color: #f9fafb;
    }

    .page-wrapper {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1.5rem;
      padding: 1.5rem;
      max-width: 1200px;
      margin: 0 auto;
    }

    .pet-card {
      background: #020617;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.65);
      display: flex;
      flex-direction: column;
      border: 1px solid rgba(148, 163, 184, 0.24);
    }

    .pet-image-wrapper {
      width: 100%;
      padding-top: 70%;
      position: relative;
      overflow: hidden;
    }

    .pet-image {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.35s ease;
    }

    .pet-card:hover .pet-image { transform: scale(1.05); }

    .pet-meta { padding: 0.85rem 1rem 1rem; }

    .pet-id {
      display: inline-block;
      font-size: 0.7rem;
      font-weight: 600;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: #94a3b8;
      margin-bottom: 0.25rem;
    }

    .pet-name {
      margin: 0;
      font-size: 1.05rem;
      font-weight: 600;
      color: #e5e7eb;
    }

    .pet-team,
    .pet-owner {
      margin: 0.25rem 0 0;
      font-size: 0.85rem;
      color: #cbd5f5;
    }

    .pet-team { color: #38bdf8; }

    .status-message {
      padding: 0 1.5rem 1.5rem;
      font-size: 0.9rem;
      color: #e5e7eb;
      text-align: center;
    }

    .status-error { color: #fca5a5; }

    /* Debug panel */
    .debug-panel {
      background: #020617;
      color: #e5e7eb;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 11px;
      padding: 0.75rem 1rem 1rem;
      border-top: 1px solid rgba(148, 163, 184, 0.35);
      max-height: 260px;
      overflow: auto;
      white-space: pre-wrap;
    }

    .debug-panel h2 {
      margin: 0 0 0.25rem;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #94a3b8;
    }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <div id="gallery" class="gallery"></div>

    <div id="gallery-loading" class="status-message">Loading pets…</div>
    <div id="gallery-error" class="status-message status-error" hidden>
      Sorry, we couldn’t load the pets right now.
    </div>

    <!-- Debug info visible on the page -->
    <div class="debug-panel">
      <h2>Debug info (for dev only – remove later)</h2>
      <div id="debug-log"></div>
    </div>
  </div>

  <!-- PapaParse -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <script>
    const CSV_URL =
      "https://docs.google.com/spreadsheets/d/e/2PACX-1vTFX7nWMq_3plmeprD6ncT1UQA1BiUYwjdh2SSnKstU3FSPKILos79nA-SAYddYV_gt2iyslYqqMWp2/pub?gid=1795204638&single=true&output=csv";

    function logDebug(msg, obj) {
      const el = document.getElementById("debug-log");
      const text = typeof obj !== "undefined" ? msg + " " + JSON.stringify(obj, null, 2) : msg;
      el.textContent += text + "\n";
    }

    function convertDriveLink(url) {
      if (!url) return "";
      let fileId = "";

      if (url.includes("open?id=")) {
        fileId = url.split("open?id=")[1];
      } else if (url.includes("/file/d/")) {
        fileId = url.split("/file/d/")[1].split("/")[0];
      }

      if (fileId) {
        return `https://drive.google.com/uc?export=view&id=${fileId}`;
      }
      return url;
    }

    // Column mapping for YOUR CSV:
    // 0 Timestamp
    // 1 Email address
    // 2 Email address (form)
    // 3 Full name
    // 4 Pet’s name
    // 5 Your pet’s NBA team
    // 6 Upload your pet’s photo
    // 7 Photo Rights
    // 8 AN Rights
    // 9 Age / Residency
    // 10 Approved
    function createPetCard(columns, index) {
      const ownerName = columns[3] || "";
      const petName = columns[4] || "";
      const team = columns[5] || "";
      const rawImageUrl = columns[6] || "";
      const approvedRaw = columns[10] || "";

      const approved = approvedRaw.toString().trim().toLowerCase();
      const imageUrl = convertDriveLink(rawImageUrl);

      logDebug("Row " + index + " parsed:", {
        ownerName,
        petName,
        team,
        rawImageUrl,
        imageUrl,
        approved
      });

      if (approved !== "yes" || !imageUrl) return null;

      const petId = "PET" + String(index + 1).padStart(3, "0");

      const card = document.createElement("article");
      card.className = "pet-card";

      card.innerHTML = `
        <div class="pet-image-wrapper">
          <img
            src="${imageUrl}"
            alt="${petName || "Pet"} – ${team || ""}"
            class="pet-image"
            loading="lazy"
          />
        </div>
        <div class="pet-meta">
          <span class="pet-id">${petId}</span>
          <h3 class="pet-name">${petName || "Unnamed pet"}</h3>
          <p class="pet-team">${team || "NBA team not specified"}</p>
          ${ownerName ? `<p class="pet-owner">Submitted by ${ownerName}</p>` : ""}
        </div>
      `;

      return card;
    }

    function renderGallery(rows) {
      const gallery = document.getElementById("gallery");
      const loadingEl = document.getElementById("gallery-loading");
      const errorEl = document.getElementById("gallery-error");

      loadingEl.hidden = true;
      errorEl.hidden = true;
      gallery.innerHTML = "";

      if (!rows || rows.length === 0) {
        loadingEl.hidden = false;
        loadingEl.textContent = "No approved entries yet.";
        logDebug("No rows to render.");
        return;
      }

      rows.forEach((cols, i) => {
        const card = createPetCard(cols, i);
        if (card) gallery.appendChild(card);
      });

      if (gallery.children.length === 0) {
        loadingEl.hidden = false;
        loadingEl.textContent = "No approved entries after filtering.";
        logDebug("No cards created from rows.");
      } else {
        logDebug("Cards created:", { count: gallery.children.length });
      }
    }

    function initGallery() {
      const loadingEl = document.getElementById("gallery-loading");
      const errorEl = document.getElementById("gallery-error");

      loadingEl.hidden = false;
      errorEl.hidden = true;

      logDebug("Starting Papa.parse on CSV_URL:", CSV_URL);

      Papa.parse(CSV_URL, {
        download: true,
        skipEmptyLines: "greedy",
        complete: function (results) {
          logDebug("Papa.parse complete. Raw results.data length:", results.data.length);

          const allRows = results.data || [];
          // Skip header row (index 0)
          const dataRows = allRows.slice(1).filter(row => row && row.length > 1);

          logDebug("Data rows after slicing header & removing empties:", {
            count: dataRows.length,
            firstRow: dataRows[0]
          });

          renderGallery(dataRows);
        },
        error: function (err) {
          console.error("Papa.parse error:", err);
          logDebug("Papa.parse ERROR:", err);
          loadingEl.hidden = true;
          errorEl.hidden = false;
        }
      });
    }

    document.addEventListener("DOMContentLoaded", initGallery);
  </script>
</body>
</html>
